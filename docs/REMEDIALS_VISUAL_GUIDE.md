# 📊 Визуальное руководство системы ремедиалов

## Архитектура системы

```
┌─────────────────────────────────────────────────────────────────┐
│                      СИСТЕМА ОБУЧЕНИЯ                            │
│                    15-блочный структурированный урок             │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                  ТРЕКИНГ ПРОГРЕССА УЧЕНИКА                       │
│                                                                   │
│  LessonProgressTracker                                            │
│  ├─ Записывает каждый ответ                                      │
│  ├─ Отслеживает ошибки                                           │
│  ├─ Ведет статистику                                             │
│  └─ Определяет блоки для повторения                              │
└─────────────────────────────────────────────────────────────────┘
                              ↓
                    Ученик завершает урок
                              ↓
                      АНАЛИЗ ОШИБОК
                              ↓
                    ┌─────────────┐
                    │   Есть      │
                    │  ошибки?    │
                    └──┬──────┬───┘
                      ДА    НЕТ
                       ↓      ↓
                       │      └─→ ✅ Урок завершен!
                       │          (Ремедиалы не нужны)
                       ↓
        ┌────────────────────────────────┐
        │  ГЕНЕРИРОВАНИЕ РЕМЕДИАЛОВ      │
        │                                │
        │  1. Получить список ошибок     │
        │  2. Создать промпт для AI      │
        │  3. Отправить в OpenAI         │
        │  4. Получить новые блоки       │
        │  5. Парсить JSON ответ         │
        │  6. Вставить в урок            │
        └────────────────────────────────┘
                       ↓
        ┌────────────────────────────────┐
        │   УРОК С РЕМЕДИАЛАМИ           │
        │                                │
        │  Блоки 1-15: Оригинальные      │
        │  Разделитель: 🔄 Повторение    │
        │  Блоки 1000+: Ремедиали        │
        │  Финальный: ✅ Завершение      │
        └────────────────────────────────┘
```

## Поток обработки практического вопроса

```
Ученик видит вопрос
         ↓
    [Выбирает ответ]
         ↓
   onClick handler
         ↓
  handlePracticeAnswer()
         ↓
  tracker.recordAnswer()
         ↓
         ├─ Сравнивает с правильным
         ├─ Записывает в историю
         └─ Если ❌ → добавляет в failedBlocks
         ↓
   [Визуальная обратная связь]
         ↓
  ✅ Правильно! / ❌ Неправильно!
```

## Структура данных ученика

```typescript
┌──────────────────────────────────────────┐
│      LessonProgressTracker               │
├──────────────────────────────────────────┤
│ lessonId: string                         │
│ totalBlocksOriginal: number (15)         │
│                                          │
│ performanceHistory: BlockPerformance[]   │
│ ├─ blockId: 2                            │
│ ├─ question: "What is must?"             │
│ ├─ userAnswer: "must"                    │
│ ├─ correctAnswer: "must"                 │
│ ├─ isCorrect: true ✅                    │
│ └─ timestamp: Date                       │
│                                          │
│ failedBlocks: FailedBlockEntry[]         │
│ ├─ blockId: 2                            │
│ ├─ blockTitle: "Модальные глаголы"       │
│ ├─ failureCount: 1                       │
│ └─ difficulty: "beginner"                │
│                                          │
│ remedialsAdded: RemedialsAddedEntry[]    │
│ ├─ originalBlockId: 2                    │
│ ├─ remedialsGenerated: 2                 │
│ └─ addedAfterBlockId: 15                 │
└──────────────────────────────────────────┘
```

## Пример: Трансформация урока

### ДО (15 блоков)

```
Блок 1:  📖 Введение
Блок 2:  ✍️ Практика 1 - USER: ❌ Неправильно
Блок 3:  🎤 Произношение
Блок 4:  📖 Теория Часть 1
Блок 5:  ✍️ Практика 2 - USER: ✅ Правильно
Блок 6:  🎤 Произношение
Блок 7:  📖 Теория Часть 2
Блок 8:  🎯 Интерактив 1 - USER: ✅ Правильно
Блок 9:  🎤 Произношение
Блок 10: 📖 Расширенная теория
Блок 11: ✍️ Практика 4 - USER: ❌ Неправильно
Блок 12: 🎤 Произношение
Блок 13: 📖 Примеры и кейсы
Блок 14: 🎯 Итоговое задание - USER: ✅ Правильно
Блок 15: 📋 Заключение
```

### ПОСЛЕ (15 + ремедиалы)

```
Блок 1:  📖 Введение
Блок 2:  ✍️ Практика 1 - USER: ❌ Неправильно
Блок 3:  🎤 Произношение
Блок 4:  📖 Теория Часть 1
Блок 5:  ✍️ Практика 2 - USER: ✅ Правильно
Блок 6:  🎤 Произношение
Блок 7:  📖 Теория Часть 2
Блок 8:  🎯 Интерактив 1 - USER: ✅ Правильно
Блок 9:  🎤 Произношение
Блок 10: 📖 Расширенная теория
Блок 11: ✍️ Практика 4 - USER: ❌ Неправильно
Блок 12: 🎤 Произношение
Блок 13: 📖 Примеры и кейсы
Блок 14: 🎯 Итоговое задание - USER: ✅ Правильно
Блок 15: 📋 Заключение

════════════════════════════════════════════
🔄 ПОВТОРЕНИЕ ТРУДНОГО МАТЕРИАЛА
════════════════════════════════════════════

Блок 1000: ✍️ Повторение: Практика 1 (Подход #2)
           НОВЫЕ примеры и вопросы
           
Блок 1001: ✍️ Повторение: Практика 4 (Подход #2)
           НОВЫЕ примеры и вопросы

════════════════════════════════════════════
✅ ОТЛИЧНО! ВЫ ГОТОВЫ ПРОДОЛЖАТЬ
════════════════════════════════════════════
```

## Статистика прогресса

```
┌─────────────────────────────────────┐
│   📊 СТАТИСТИКА ПРОГРЕССА           │
├─────────────────────────────────────┤
│ Всего вопросов:        15           │
│ Правильных ответов:    13           │
│ Точность:              87%          │
│ Блоков для повторения: 2            │
│ Ремедиалов добавлено:  2            │
└─────────────────────────────────────┘

Визуальное представление:
┌─────────────────────────┐
│  ✅ ✅ ❌ ✅ ✅ ✅ ✅ ✅ │
│  ✅ ✅ ✅ ✅ ✅ ❌ ✅ │
└─────────────────────────┘
```

## Поток с ремедиалами в реальном времени

```
Время:          Действие:                           Состояние:

10:00 AM        Ученик начинает урок                Инициализация трекера
                                                    failedBlocks = []

10:02 AM        Блок 2 (Практика): ❌               failedBlocks = [
                                                      { blockId: 2, ... }
                                                    ]

10:05 AM        Блок 11 (Практика): ❌              failedBlocks = [
                                                      { blockId: 2, ... },
                                                      { blockId: 11, ... }
                                                    ]

10:18 AM        Ученик завершает блок 15            shouldAddRemedials() = true
                                                    
                Генерирование ремедиалов...
                ├─ Создание промпта
                ├─ Запрос к OpenAI
                ├─ Парсинг JSON
                └─ Вставка в урок

10:19 AM        Ремедиалы добавлены!                blocks = [1..15 + sep + 1000..1001]
                                                    remedialsGenerated = true

10:20 AM        Ученик видит сообщение:             remedialsAdded = [
                "🔄 Повторение трудного             { originalBlockId: 2, ... },
                материала добавлено!"               { originalBlockId: 11, ... }
                                                    ]

10:25 AM        Ученик выполняет ремедиалы          performanceHistory += new answers
                и улучшает понимание
```

## Интеграция UI компонентов

```
┌─────────────────────────────────────────────────────┐
│              Chat Component                          │
├─────────────────────────────────────────────────────┤
│                                                     │
│  ┌─────────────────────────────────────────────┐   │
│  │  RemedialsSystemComponent                   │   │
│  │  ├─ Статистика прогресса (4 карточки)      │   │
│  │  ├─ Список неправильных блоков              │   │
│  │  ├─ Инструкции по повторению                │   │
│  │  └─ Статус генерации                        │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  ┌─────────────────────────────────────────────┐   │
│  │  Блоки урока (с ремедиалами)                │   │
│  │  ├─ renderPracticeBlock()     (обычные)     │   │
│  │  ├─ renderSeparator()         (разделитель) │   │
│  │  └─ renderRemedialsBlock()    (ремедиалы)   │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
└─────────────────────────────────────────────────────┘
```

## Жизненный цикл ремедиала

```
Ремедиальный блок
       ↓
┌──────────────────────────────────────┐
│ Показываем ремедиал студенту         │
│ (Другие примеры, упрощенное объ-е)   │
└──────────────────────────────────────┘
       ↓
  Студент отвечает
       ↓
  ✅ ПРАВИЛЬНО              ❌ НЕПРАВИЛЬНО
     ↓                          ↓
  Материал                  Показываем объяснение
  закреплен! ✓              Предлагаем еще раз

     ↓                          ↓
  Переход к                Студент может попробовать
  следующему               еще раз или перейти дальше
```

## Метрики успеха

```
┌────────────────────────────────────────┐
│ МЕТРИКИ КАЧЕСТВА РЕМЕДИАЛОВ            │
├────────────────────────────────────────┤
│                                        │
│ 1. Эффективность                       │
│    ├─ % студентов, решивших ремедиал  │
│    └─ Улучшение точности                │
│                                        │
│ 2. Релевантность                       │
│    ├─ Соответствие оригинальной теме  │
│    └─ Использование новых примеров     │
│                                        │
│ 3. Адаптивность                        │
│    ├─ Количество ремедиалов по блоку   │
│    └─ Сложность ремедиалов             │
│                                        │
│ 4. Вовлеченность                       │
│    ├─ Время на ремедиалы                │
│    └─ Завершение ремедиалов             │
│                                        │
└────────────────────────────────────────┘
```

